package public_graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.57

import (
	"context"
	"fmt"

	user_model "brume.dev/account/user/model"
	builder_model "brume.dev/builder/model"
	generated "brume.dev/internal/router/public-gql/graph/generated/generated.go"
	public_graph_model "brume.dev/internal/router/public-gql/graph/model"
	project_model "brume.dev/project/model"
	runner_model "brume.dev/runner/model"
	service_model "brume.dev/service/model"
	"github.com/google/uuid"
)

// Source is the resolver for the source field.
func (r *baseServiceResolver) Source(ctx context.Context, obj *service_model.BaseService) (*public_graph_model.Source, error) {
	panic(fmt.Errorf("not implemented: Source - source"))
}

// Data is the resolver for the data field.
func (r *builderResolver) Data(ctx context.Context, obj *builder_model.Builder) (any, error) {
	return obj.Data, nil
}

// CreateProject is the resolver for the createProject field.
func (r *mutationResolver) CreateProject(ctx context.Context, name string, description *string) (*project_model.Project, error) {
	currentUser := ctx.Value("user").(string)
	user, err := r.UserService.GetUserByProviderID(currentUser)
	if err != nil {
		return nil, err
	}

	org, err := r.UserService.GetUserOrganization(user)
	if err != nil {
		return nil, err
	}

	project, err := r.ProjectService.CreateProject(name, *description)
	if err != nil {
		return nil, err
	}

	return r.ProjectService.AssignProjectToOrganization(project, org)
}

// AddServiceToProject is the resolver for the addServiceToProject field.
func (r *mutationResolver) AddServiceToProject(ctx context.Context, projectID string, input public_graph_model.CreateServiceInput) (*service_model.Service, error) {
	service, err := r.ServiceService.CreateService(input.Name, uuid.MustParse(projectID), input.Image)
	if err != nil {
		return nil, err
	}

	project, perr := r.ProjectService.GetProjectByID(uuid.MustParse(projectID))

	if perr != nil {
		return nil, perr
	}

	_, err = r.ProjectService.AddServiceToProject(project, service)
	if err != nil {
		return nil, err
	}

	return service, nil
}

// DeleteService is the resolver for the deleteService field.
func (r *mutationResolver) DeleteService(ctx context.Context, serviceID string) (*service_model.Service, error) {
	service_uuid, err := uuid.Parse(serviceID)
	if err != nil {
		return nil, err
	}

	return r.ServiceService.DeleteService(service_uuid)
}

// UpdateServiceSettings is the resolver for the updateServiceSettings field.
func (r *mutationResolver) UpdateServiceSettings(ctx context.Context, serviceID string, input public_graph_model.ServiceSettingsInput) (*service_model.Service, error) {
	service_uuid, err := uuid.Parse(serviceID)
	if err != nil {
		return nil, err
	}

	return r.ServiceService.UpdateServiceSettings(service_uuid, input.Name)
}

// DeleteDraft is the resolver for the deleteDraft field.
func (r *mutationResolver) DeleteDraft(ctx context.Context, projectID string) (*project_model.Project, error) {
	project_uuid, err := uuid.Parse(projectID)
	if err != nil {
		return nil, err
	}

	return r.ProjectService.DeleteDraft(project_uuid)
}

// DeployProject is the resolver for the deployProject field.
func (r *mutationResolver) DeployProject(ctx context.Context, projectID string) (*project_model.Project, error) {
	project_uuid, err := uuid.Parse(projectID)
	if err != nil {
		return nil, err
	}

	return r.ProjectService.DeployProject(project_uuid)
}

// ID is the resolver for the id field.
func (r *projectResolver) ID(ctx context.Context, obj *project_model.Project) (string, error) {
	return obj.ID.String(), nil
}

// IsDirty is the resolver for the isDirty field.
func (r *projectResolver) IsDirty(ctx context.Context, obj *project_model.Project) (bool, error) {
	return r.ProjectService.IsDirty(obj)
}

// Services is the resolver for the services field.
func (r *projectResolver) Services(ctx context.Context, obj *project_model.Project) ([]*service_model.Service, error) {
	betterProject, err := r.ProjectService.GetProject(obj)
	return betterProject.Services, err
}

// Me is the resolver for the me field.
func (r *queryResolver) Me(ctx context.Context) (*user_model.User, error) {
	pid := ctx.Value("user").(string)
	user, err := r.UserService.GetUserByProviderID(pid)
	if err != nil {
		return nil, err
	}

	return user, nil
}

// GetProjectByID is the resolver for the getProjectById field.
func (r *queryResolver) GetProjectByID(ctx context.Context, id string) (*project_model.Project, error) {
	project_uuid, err := uuid.Parse(id)
	if err != nil {
		return nil, err
	}

	return r.ProjectService.GetProjectByID(project_uuid)
}

// Link is the resolver for the link field.
func (r *runnerResolver) Link(ctx context.Context, obj *runner_model.Runner) (string, error) {
	panic(fmt.Errorf("not implemented: Link - link"))
}

// Version is the resolver for the version field.
func (r *runnerResolver) Version(ctx context.Context, obj *runner_model.Runner) (string, error) {
	panic(fmt.Errorf("not implemented: Version - version"))
}

// Data is the resolver for the data field.
func (r *runnerResolver) Data(ctx context.Context, obj *runner_model.Runner) (any, error) {
	panic(fmt.Errorf("not implemented: Data - data"))
}

// ID is the resolver for the id field.
func (r *serviceResolver) ID(ctx context.Context, obj *service_model.Service) (string, error) {
	return obj.ID.String(), nil
}

// ID is the resolver for the id field.
func (r *userResolver) ID(ctx context.Context, obj *user_model.User) (string, error) {
	return obj.ID.String(), nil
}

// Projects is the resolver for the projects field.
func (r *userResolver) Projects(ctx context.Context, obj *user_model.User) ([]*project_model.Project, error) {
	projects, err := r.UserService.GetUserProjects(obj)

	return projects, err
}

// Organization is the resolver for the organization field.
func (r *userResolver) Organization(ctx context.Context, obj *user_model.User) (*public_graph_model.Organization, error) {
	org, err := r.UserService.GetUserOrganization(obj)
	if err != nil {
		return nil, err
	}

	return &public_graph_model.Organization{
		ID:         org.ID.String(),
		ProviderID: org.ProviderID,
		Name:       org.Name,
	}, nil
}

// BaseService returns generated.BaseServiceResolver implementation.
func (r *Resolver) BaseService() generated.BaseServiceResolver { return &baseServiceResolver{r} }

// Builder returns generated.BuilderResolver implementation.
func (r *Resolver) Builder() generated.BuilderResolver { return &builderResolver{r} }

// Mutation returns generated.MutationResolver implementation.
func (r *Resolver) Mutation() generated.MutationResolver { return &mutationResolver{r} }

// Project returns generated.ProjectResolver implementation.
func (r *Resolver) Project() generated.ProjectResolver { return &projectResolver{r} }

// Query returns generated.QueryResolver implementation.
func (r *Resolver) Query() generated.QueryResolver { return &queryResolver{r} }

// Runner returns generated.RunnerResolver implementation.
func (r *Resolver) Runner() generated.RunnerResolver { return &runnerResolver{r} }

// Service returns generated.ServiceResolver implementation.
func (r *Resolver) Service() generated.ServiceResolver { return &serviceResolver{r} }

// User returns generated.UserResolver implementation.
func (r *Resolver) User() generated.UserResolver { return &userResolver{r} }

type baseServiceResolver struct{ *Resolver }
type builderResolver struct{ *Resolver }
type mutationResolver struct{ *Resolver }
type projectResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }
type runnerResolver struct{ *Resolver }
type serviceResolver struct{ *Resolver }
type userResolver struct{ *Resolver }
